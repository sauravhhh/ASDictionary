<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Assamese Dictionary</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    html { box-sizing: border-box; }
    *, *:before, *:after { box-sizing: inherit; }
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #fff;
      color: #222;
      margin: 0;
    }
    header {
      padding: 2.2rem 0.8rem 1rem;
      text-align: left;
    }
    .dot {
      display: inline-block;
      width: 12px;
      height: 12px;
      background: #e12d39;
      border-radius: 50%;
      margin-right: 12px;
      vertical-align: middle;
    }
    .title {
      font-size: 2rem;
      font-weight: bold;
      vertical-align: middle;
      letter-spacing: 0.02em;
    }
    .title span:last-child { color: #e12d39; }
    .subtitle {
      color: #888;
      font-size: 1rem;
      letter-spacing: 0.7px;
      margin-left: 0.5rem;
      margin-top: 0.6rem;
    }
    .container {
      max-width: 420px;
      margin: 2rem auto;
      background: #fff;
      border-radius: 10px;
      padding: 1.5rem 1rem 0.5rem;
      box-shadow: 0 2px 8px #efefef;
    }
    .search-box {
      width: 100%;
      font-size: 1.05rem;
      padding: 0.85rem 1rem;
      border: 1px solid #dedede;
      border-radius: 7px;
      margin-bottom: 0.8rem;
      outline: none;
      background: #fafbfc;
      transition: border 0.15s;
    }
    .search-box:focus { border-color: #e12d39; }
    .btn-row {
      display: flex;
      justify-content: flex-end;
      gap: 0.7rem;
      margin-bottom: 1.2rem;
    }
    button {
      font-size: 1rem;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      outline: none;
      transition: background 0.1s;
    }
    .search-btn {
      background: #e12d39;
      color: #fff;
    }
    .search-btn:active,
    .search-btn:focus { background: #b71a26; }
    .clear-btn {
      background: #f4f4f6;
      color: #888;
    }
    .clear-btn:active,
    .clear-btn:focus { background: #eee; }
    .result {
      padding-top: 0.5rem;
    }
    .word {
      font-size: 1.45rem;
      font-weight: bold;
      margin-bottom: 0.15rem;
      word-break: break-word;
    }
    .partofspeech {
      font-size: 1.02rem;
      color: #8d99ae;
      margin-bottom: 0.6rem;
      margin-top: 0rem;
      word-break: break-word;
    }
    .section {
      margin: 1rem 0 0.4rem;
      font-weight: 600;
      font-size: 1.07rem;
      color: #323648;
    }
    .meanings {
      margin-bottom: 0.7rem;
      word-break: break-word;
      font-size: 1rem;
    }
    .empty {
      color: #bbb;
      font-size: 1.08rem;
      text-align: left;
      margin-top: 1.3rem;
    }
    .footer {
      text-align: center;
      margin: 2.5rem 0 1rem;
      font-size: 1rem;
      color: #222;
      letter-spacing: 0.02em;
      font-weight: 500;
    }
    @media (max-width: 520px) {
      .container {
        margin: 1rem;
        padding: 1.2rem 0.4rem 0.3rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <span class="dot"></span>
    <span class="title">অসমীয়া<span>.</span></span>
    <div class="subtitle">Assamese Dictionary</div>
  </header>
  <div class="container">
    <input class="search-box" type="text" autocomplete="off" autocapitalize="off" spellcheck="false"
      placeholder="Search in Assamese, English, or Meaning…" id="searchInput">
    <div class="btn-row">
      <button class="clear-btn" id="clearBtn" title="Clear">✕</button>
      <button class="search-btn" id="searchBtn" title="Search">Search</button>
    </div>
    <div class="result" id="result"></div>
  </div>
  <div class="footer">Made with ❤️ by Sauravhhh</div>
  <script>
    let allWords = [];
    const searchInput = document.getElementById('searchInput');
    const resultDiv = document.getElementById('result');
    const clearBtn = document.getElementById('clearBtn');
    const searchBtn = document.getElementById('searchBtn');

    // CSV parser (handles commas, trims whitespace)
    function parseCSV(csv) {
      const lines = csv.split(/\r?\n/).filter(l => l.trim());
      const headers = lines[0].split(',').map(h => h.trim());
      return lines.slice(1).map(line => {
        const cells = line.split(',').map(c => c.trim());
        let obj = {};
        headers.forEach((h, i) => obj[h] = cells[i] || '');
        return obj;
      });
    }

    // Load both CSV files and join
    Promise.all([
      fetch('xobdo-words-AS.csv').then(r => r.text()),
      fetch('xobdo-words-EN.csv').then(r => r.text())
    ]).then(([asCSV, enCSV]) => {
      const asData = parseCSV(asCSV);
      const enData = parseCSV(enCSV);
      allWords = asData.concat(enData);
    });

    function showResult(term) {
      resultDiv.innerHTML = "";
      const trimmedTerm = term.trim();
      if (!trimmedTerm) return;

      // Case insensitive exact (whole word) match for Wrd or any column
      const matches = allWords.filter(entry =>
        Object.values(entry).some(
          v => v?.toString().toLowerCase() === trimmedTerm.toLowerCase()
        ) ||
        (entry.Wrd && extractBracketContent(entry.Wrd).toLowerCase() === trimmedTerm.toLowerCase())
      );

      if (matches.length === 0) {
        resultDiv.innerHTML = "<div class='empty'>No result found.</div>";
        return;
      }

      resultDiv.innerHTML = matches.map(found => `
        <div style="margin-bottom:1.4rem;">
          <div class="word">${sanitize(entryOrEmpty(found.Wrd))}</div>
          <div class="partofspeech">
            ${sanitize(entryOrEmpty(found.posAsm))}${found.posEng ? ' / ' + sanitize(found.posEng) : ''}
          </div>
          <div class="section">Meanings</div>
          <div class="meanings">${sanitize(entryOrEmpty(found.Meanings))}</div>
          ${found.IdeaID ? `<div style="color:#bbb; font-size:0.9em; margin-top:0.8rem;">IdeaID: ${sanitize(entryOrEmpty(found.IdeaID))}</div>` : ""}
        </div>
      `).join('');
    }

    function extractBracketContent(str) {
      const m = /\(([^)]+)\)/.exec(str || '');
      return m ? m[1] : '';
    }

    function entryOrEmpty(val) { return val ? val : ""; }
    function sanitize(str) {
      const d = document.createElement('div');
      d.textContent = str;
      return d.innerHTML;
    }

    searchBtn.addEventListener('click', () => {
      showResult(searchInput.value);
    });
    searchInput.addEventListener('keyup', function(e) {
      if (e.key === 'Enter') showResult(this.value);
    });
    clearBtn.addEventListener('click', function() {
      searchInput.value = "";
      resultDiv.innerHTML = "";
      searchInput.focus();
    });
    window.onload = function() {
      searchInput.focus();
    };
  </script>
</body>
</html>
